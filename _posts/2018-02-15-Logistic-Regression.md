---
layout: post
title:  "Logistic Regression"
date:   2018-02-15
excerpt: "Basic things about logistic regression"
tag:
- markdown 
- mathjax
comments: false
---
# **Logistic Regression**

### **Linear Regression**

로지스틱 회귀에 들어가기 앞서, 우선 회귀의 가장 기본적인 '선형회귀'에 대해 간단하게 짚고 넘어가려고 한다.

![선형회귀 예시](https://upload.wikimedia.org/wikipedia/commons/b/be/Normdist_regression.png)

위에 보이는 그림과 같이 선형회귀는 주어진 데이터들을 좌표 상에 점으로 나타내어 종속변수와 한개 이상의 독립변수 사이의 선형관계를 모델링하는 기법이다.

그림처럼 종속변수가 연속형이라면 계속해서 이어지는 선형의 형태로 회귀식을 만들어도 아무런 문제가 없다. 하지만 종속변수가 범주형이라면 이야기는 달라질 수 있다.

### **Problems when we use linear regression**

종속변수가 범주형 변수일 때 선형회귀를 사용한다면 생길 수 있는 문제로는 크게 두가지가 있다. 

**1) 의미없는 회귀식 생성**

![Y]('https://github.com/jiwon12-31/jiwon12-31.github.io/blob/master/assets/img/Y.JPG')

제시된 종속변수는 범주형 변수로 1, 2, 3 각각의 숫자는 서로 다른 질병을 나타낸다. 이때의 숫자들은 숫자로서의 의미를 가지고 있지 않다. 즉, 각 숫자가 나타내는 병명이 바뀌어도 아무런 상관이 없다.

하지만 그러한 변화가 일어났을 때 선형회귀를 적용한다면, 전혀 다른 회귀식이 도출될 수밖에 없다. 따라서 선형으로 도출된 회귀식은 의미가 없다고 할 수 있다.



**2) 범위의 문제**

예를 들어 한 종속변수가 binary한 값을 갖는다고 가정해보자. 그렇다면 그 종속변수는 0 아니면 1의 값을 갖는 것이다.

$$Y = β_0 + β_1X$$

다음과 같은 선형회귀식에서 종속변수 y의 범위는 0과 1 사이를 벗어난다. 따라서 그 확률을 설명하기가 힘들어지기 때문에 문제가 발생하게 된다.



### **Formula of Logistic Regression**

로지스틱 함수의 수식을 이해하기 전에 먼저 함수가 어떤 모양으로 생겼는지 알아보자.

![sigmoid](https://plot.ly/~florianh/140.png)

위 그림에서 종속변수 y는 0 아니면 1의 값만을 갖는 범주형 변수이다. 이 데이터에 대해 회귀식을 찾기 위해서는 노란색 점선으로 표시된 선형회귀 함수보다 초록색 실선으로 표시된 로지스틱 함수가 더 설명력이 높다. (이는 앞에서 설명한 것과 동일한 맥락이다.)



로지스틱 함수의 회귀식을 설명하기 위해서는 몇가지 단계가 필요하다. 

우선 로지스틱 함수는 확률을 모델링한다.

$$P(X) =  β_0 + β_1X$$

좌변은 확률이기 때문에 그 범위가 (0,1)이지만 우변은 (-inf, inf)의 범위를 갖는다. 어떤 독립변수 값에 한해서는 종속변수 값이 0 이하가 되어 확률로 설명할 수 없는 일이 벌어지는 것이다. 따라서 '오즈(odds)'의 개념을 활용하려고 한다.

오즈(odds) = $$\frac{성공할 확률}{실패할 확률}$$ = $$\frac{p(X)}{1-p(X)}$$

오즈란 결국, 성공할 확률이 실패할 확률보다 몇 배나 높은지에 관한 식이라고 볼 수 있다. 오즈의 범위는 0에서 무한대 사이일 것이다. 

간단한 예시를 통해 오즈에 대해 조금 더 깊게 알아보자.

| 대출 여부         | 파산함 (1) | 파산하지 않음 (0) |
| ----------------- | ---------- | ----------------- |
| 대출함 (1)        | 70         | 30                |
| 대출하지 않음 (0) | 40         | 60                |

위의 표는 임의대로 각 대출 금액에 따른 파산 여부를 정리한 표이다.  

대출을 했을 때 파산할 확률에 대한 오즈는 
$$\frac{P(Y=1|X=1)}{1-P(Y=1|X=1)}$$ = $$\frac{70/100}{30/100}$$ = $$\frac{7}{3}$$  이다.

그리고 대출을 하지 않았을 때 파산할 확률에 대한 오즈는 
$$\frac{P(Y=0|X=1)}{1-P(Y=0|X=1)}$$ = $$\frac{40/100}{60/100}$$ = $$\frac{2}{3}$$  이다.

오즈와 관련한 개념으로 '오즈비(odds ratio)'라는 것이 있다. 오즈비는 말 그대로 오즈들의 비율이며, 이는 두 변수에 대한 상관성을 표현한다. 대출과 파산의 관계에 대한 새로운 표를 만들어보자.

| 대출 여부         | 파산함 (1) | 파산하지 않음 (0) |
| ----------------- | ---------- | ----------------- |
| 대출함 (1)        | 50         | 50                |
| 대출하지 않음 (0) | 50         | 50                |

먼저 위의 표에서의 오즈비는 $$\frac{7/3}{2/3}$$ = $$\frac{7}{2}$$이다. 하지만 새로 만들어진 표에서의 오즈비는 1이다.  이를 해석한다면 첫번째 표에서는 대출하지 않은 사람에 비해서 대출한 사람이 파산 할 확률이 3.5배 높다는 것이고, 두번째 표에서는 대출하지 않은 사람에 비해서 대출한 사람이 파산 할 확률이 1배 높다는, 즉 같다는 것이다.

오즈를 활용하여 회귀식을 수정하면 다음과 같다.

$$\frac{p(X)}{1-p(X)}$$ = $$e^{β_0 + β_1X}$$

이 식의 양변에 로그를 취해주면 음의 무한대에서 양의 무한대에 이르는 모든 구간을 커버할 수 있게 되어 boundary problem을 해결한다.

결국 로지스틱 회귀식은 다음과 같은 모양을 갖게 된다.

$$log(\frac{p(X)}{1-p(X)})$$ = $$β_0 + β_1X$$ 

*p(X) = $$\frac{e^{β_0 + β_1X}}{1 + e^{β_0 + β_1X}}$$

로지스틱 회귀식의 좌변에 있는 식은 오즈에 로그를 취한 것으로 '로짓'이라고 불린다. 따라서 로지스틱 회귀식은 '로짓모형'이라는 또다른 이름을 가지고 있다.

### **How to find coefficients**

로지스틱 회귀식의 계수값을 찾기 위해서는 "Likelihood function"을 이용한다. 

![likelihood]('/assets/img/likelihood.JPG')

위의 식이 likelihood function이며, 위 식을 최대화 하는 각각의 $$p(x_i)$$를 찾으면 된다. 하지만 이러한 수식으로 보면 이해가 쉽게 되지 않기 때문에 아래의 예시를 통해 다시 한번 설명하려고 한다.

| 대출 금액 | 파산함 (1) | 파산하지 않음 (0) |
| --------- | ---------- | ----------------- |
| 100       | 10         | 90                |
| 200       | 30         | 70                |
| 300       | 60         | 40                |

위의 표는 임의대로 각 대출 금액에 따른 파산 여부를 정리한 표이다. 

$$P(Y=1|X=100)$$ = $$p_1$$,
$$P(Y=1|X=200)$$ = $$p_2$$, 
$$P(Y=1|X=300)$$ = $$p_3$$, 
$$P(Y=1|X=400)$$ = $$p_4$$  라고 했을 때 Likelihood는 다음과 같이 계산할 수 있다.

Likelihood = $$p_1^{10} (1-p_1)^{90} p_2^{30}(1-p_2)^{70}p_3^{60}(1-p_3)^{40}$$

위의 likelihood를 최대로 되게 만드는 각각의 p들을 구하면 그것들이 바로 로지스틱 회귀의 계수가 된다.

### **Advantages / Disadvantages**

로지스틱 회귀는 계속해서 언급한 바와 같이 범주형 변수일 때 예측력이 높다. 또한 오즈를 사용하였기 때문에 종속변수와 독립변수의 관계 해석을 쉽게 할 수 있다.

하지만 관계 해석이 쉽다는 것은 독립변수의 갯수가 적을 때의 이야기이다. 변수의 갯수가 많아지면 해석이 힘들어지게된다. 또한 원래 로지스틱 회귀는 이항형 로지스틱 회귀(binomial logistic regression)와 다항형 로지스틱 회귀(multinomial logistic regression)의 2가지 종류를 포함한다. 보통 이야기하는 로지스틱 회귀는 이항형이다. 다항형 로지스틱 회귀도 종속변수 예측이 가능하기는 하지만 예측력이 떨어지기 때문에 보통 사용하지 않는다.



#### **Reference** ####
https://upload.wikimedia.org/wikipedia/commons/b/be/Normdist_regression.png

https://plot.ly/~florianh/140.png

An Introduction to Statistical Learning with Applications in R

Principles of Data Science
